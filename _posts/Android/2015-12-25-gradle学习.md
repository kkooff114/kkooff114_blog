---
layout:         post
title:          Gradle学习
description:    在实践Android热部署解决方案的时候需要用的gradle来动态修改class中的方法,以及在编译的时候比较两个版本之前修改的class
tags:           Android, gradle
keywords:       Android, gradle
noToc: 			  true
---

#创建task
##基础
```java
task hello << {
    println 'Hello world!'
}
hello.doFirst {
    println 'Hello Venus'
}
hello.doLast {
    println 'Hello Mars'
}
```
以上定义了一个叫做hello的任务, 任务是一个可执行的`闭包`
其中`<<`可以替换成`doLast`

```java
task hello {
    doLast {
        println 'Hello world!'
    }
}
```
最终输出

```
Hello Venus
Hello world!
Hello Mars
```
##在 Gradle 任务里使用 Groovy
例子1: 
build.gradle

```java
task upper << {
    String someString = 'mY_nAmE'
    println "Original: " + someString
    println "Upper case: " + someString.toUpperCase()
}
```
cd到build.gradl路径下`gradle -q upper` 命令的输出

```
> gradle -q upper
Original: mY_nAmE
Upper case: MY_NAME
```

例子2: 
build.gradle

```java
task count << {
    4.times { print "$it " }
}
```
cd到build.gradl路径下`gradle -q upper` 命令的输出

```
> gradle -q count
0 1 2 3
```

##任务依赖
```java
task hello << {
    println 'Hello world!'
}

task intro(dependsOn: hello) << {
    println "I'm Gradle"
}

// 如果有多个任务需要被依赖
task intro(dependsOn: [hello1, hello2]) << {
    println "I'm Gradle"
}
```
```
gradle -q intro 命令的输出

```java
> gradle -q intro
Hello world!
I'm Gradle
```
任务intro依赖任务hello, 所以限制性hello, 再执行intro.

#内置属性
##操纵任务
普通的Java工程有一个有限的任务集合，这些任务相互配合创建一个输出。 classes 是一个编译Java源代码的任务。 在build.gradle中通过脚本访问和使用classes任务是很简单的。可以通过project.tasks.classes快捷访问。

对于Android工程来说就比较复杂了，因为可能有很多相同的任务，他们的名字是基于 Build Types和Product Flavors 生成的。

为了解决这个问题， android 对象提供了两个属性：

* applicationVariants (仅仅适用于app plugin)
* libraryVariants (仅仅适用于library plugin)
* testVariants (两种plugin都适用)
ApplicationVariant, LibraryVariant, and TestVariant这三个对象都会分别返回一个DomainObjectCollection。

请注意访问这些集合中的任何一个都会触发生成所有的创建。这意味着访问这些集合后无须重新配置就会产生。

DomainObjectCollection允许直接的访问所有对象，或者通过更为方便的过滤器访问。

```
android.applicationVariants.each { variant ->
    ....
}
```
![](/media/14522425746549.jpg)
![](/media/14522425883559.jpg)
![](/media/14522426056403.jpg)
![](/media/14522426176157.jpg)

