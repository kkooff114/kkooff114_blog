---
layout:         post
title:          上传依赖库到Jcenter
description:    如何上传Android依赖库到Jcenter中
tags:           Android, gradle, Jcenter
keywords:       Android, gradle, Jcenter
noToc: 			  true
---


[TOC]

#注册Jcenter账号
官网地址: [https://bintray.com/](https://bintray.com/)
自行注册

#项目配置

##Step1: 项目根build.gradle
在项目根build.gradle中添加
`Gradle >= 2.1`

```
plugins {
    id "com.jfrog.bintray" version "1.4"
}
```

`Gradle < 2.1`

```
buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.4'
    }
}
apply plugin: 'com.jfrog.bintray'
```

我gradle的版本是`1.5.0`, 所以我添加完大概长这个样子:

![](/media/14519204995360.jpg)

同步Sync, 成功!

##Step2: 配置user, key
###方式一:gradle.properties(好像不行, 回头有时间研究下!)
![](/media/14519221074529.jpg)

在module的build.gradle中就可以通过`project.property('bintrayUser')`这种方式来访问

```
bintray {
    user = project.property('bintrayUser')
    key = project.property('bintrayKey')
    ...
}
```

###方式二:local.properties
![](/media/14689242075547.jpg)

在module的build.gradle中就可以通过`System.getenv('BINTRAY_USER')`这种方式来访问

```
bintray {
    user = System.getenv('BINTRAY_USER')
    key = System.getenv('BINTRAY_KEY')
    ...
}
```

##Step3: 增加package的一些信息到`bintray`闭包中
**必填:**

1. repo - existing repository in bintray to add the artifacts to (for 2. example: 'generic', 'maven' etc)
3. name - package name
4. licenses - your package licenses
5. vcsUrl - your VCS URL

**可选:**

1. userOrg – an optional organization name when the repo belongs to one of the user's orgs. If not added will use 'BINTRAY_USER' by default

所以我的`bintray`长这样子:

```
def siteUrl = 'http://blog.loujiwei.cn'   // 项目的主页
def gitUrl = 'git@github.com:kkooff114/HotFit.git'   // Git仓库的url

bintray {   
    user = System.getenv('BINTRAY_USER')
    key = System.getenv('BINTRAY_KEY')
    pkg {
        repo = 'maven'
        name = 'cn.loujiwei.android'
        licenses = ['Apache-2.0']
        vcsUrl = gitUrl
    }
}
```

##Step4: 增加Version 信息到`pkg`闭包中
**必选**

1. name - Version name

**可选**

1. desc - Version description
2. released - Date of the version release. Can accept one of the following formats:
3. Date in the format of 'yyyy-MM-dd'T'HH:mm:ss.SSSZZ'
4. java.util.Date instance
5. vcsTag - Version control tag name
6. attributes - Attributes to be attached to the version

```
bintray {
    user = System.getenv('BINTRAY_USER')
    key = System.getenv('BINTRAY_KEY')
    pkg {
        repo = 'maven'
        name = 'cn.loujiwei.android'
        licenses = ['Apache-2.0']
        vcsUrl = gitUrl

        version {
            name = '1.0.0'
            desc = 'Android Hot Fit Plugin'
            released  = new Date()
        }
    }
}
```

##Step5: 设置artifacts
```
publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java
            artifact sourcesJar
            artifact javadocJar
            groupId 'cn.loujiwei.android'
            artifactId 'hotfit'
            version versionName
        }
    }
}
```

```
bintray {
    user = System.getenv('BINTRAY_USER')
    key = System.getenv('BINTRAY_KEY')

    publications = ['mavenJava']

   ...
}
```

##最终内容
根build.gradle

```
// Top-level build file where you can add configuration options common to all sub-projects/modules.

buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:1.5.0'
        classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.4'
        classpath 'com.github.dcendents:android-maven-gradle-plugin:1.3'
        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
    }
}

allprojects {
    repositories {
        jcenter()
    }
}

task clean(type: Delete) {
    delete rootProject.buildDir
}

//apply plugin: 'com.jfrog.bintray'
```

app build.gradle

```
apply plugin: 'com.android.library'
apply plugin: 'com.github.dcendents.android-maven'
apply plugin: 'com.jfrog.bintray'

def versionName = "1.0.0" //插件版本
def siteUrl = 'http://blog.loujiwei.cn'   // 项目的主页
def gitUrl = 'git@github.com:kkooff114/HotFit.git'   // Git仓库的url


android {
    compileSdkVersion 23
    buildToolsVersion "23.0.0"

    defaultConfig {
        minSdkVersion 15
        targetSdkVersion 23
        versionCode 1
//        versionName "1.0"
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
}

group = "cn.loujiwei.android"
install {
    repositories.mavenInstaller {
        // This generates POM.xml with proper parameters
        pom {
            project {
                packaging 'aar'
                // Add your description here
                name 'Android Hot Fit'     //项目的描述 你可以多写一点
                url siteUrl
                // Set your license
                licenses {
                    license {
                        name 'The Apache Software License, Version 2.0'
                        url 'http://www.apache.org/licenses/LICENSE-2.0.txt'
                    }
                }
                developers {
                    developer {
                        id 'kkooff114'        //填写的一些基本信息
                        name 'loujiwei'
                        email 'kkooff114@gmail.com'
                    }
                }
                scm {
                    connection gitUrl
                    developerConnection gitUrl
                    url siteUrl
                }
            }
        }
    }
}



task sourcesJar(type: Jar) {
    from android.sourceSets.main.java.srcDirs
    classifier = 'sources'
}
task javadoc(type: Javadoc) {
    source = android.sourceSets.main.java.srcDirs
    classpath += project.files(android.getBootClasspath().join(File.pathSeparator))
}
task javadocJar(type: Jar, dependsOn: javadoc) {
    classifier = 'javadoc'
    from javadoc.destinationDir
}
artifacts {
    archives javadocJar
    archives sourcesJar
}



bintray {
    user = 'xxxxx'//project.property('bintrayUser')//System.getenv('BINTRAY_USER')
    key = 'xxxxx'//project.property('bintrayApiKey')//System.getenv('BINTRAY_KEY')
    configurations = ['archives']
    pkg {
        repo = 'maven'
        name = 'HotFit'
        licenses = ['Apache-2.0']
        vcsUrl = gitUrl

        version {
            name = '1.0.0'
            desc = 'Android Hot Fit Plugin'

        }
    }
}
```


