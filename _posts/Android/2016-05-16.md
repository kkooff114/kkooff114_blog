---
layout:         post
title:          Android 用户行为日志记录
description:    编写用户行为日志记录库
tags:           Android
keywords:       Android
noToc: 			  true
---

[TOC]

##背景
记录应用中用户的一些操作信息log, 可以像`Log.d()`, `Log.i()`这样记录log, 然后将这些记录保存到sd卡中, 供开发查看

##初步设计
所有输出的log都先放到临时内存中, 当该内存达到一定的阀值比如`10k`之后, 再将其持久化到sd卡

##问题分析
1. 多个线程同时写入内存时, 如何保证不会错乱
2. 保证写入线程不会被block
3. 当达到阀值后, 需要取内存数据持久化, 此时如果又有新log, 如何协调存取

由于缓存区只是单纯的存储log, 所以自然的想到直接使用`StringBuffer`来存储, 由于`StringBuffer`是线程安全的, `append`的顺序决定于他所调用的次序, 所以`问题1`也就解决了

