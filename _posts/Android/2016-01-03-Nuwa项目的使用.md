---
layout:         post
title:          Nuwa项目的使用
description:    Nuwa项目是热部署方案的一个实现, 本文记录尝试使用Nuwa构建热补丁项目
tags:           Android, gradle
keywords:       Android, gradle
noToc: 			  true
---

[TOC]

#Usage

##导入

1. 在项目根build.gradle中添加:

```
buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:1.2.3'
        classpath 'cn.jiajixin.nuwa:gradle:1.2.2'
    }
}
```
**注意: 这里gradle需要使用1.2.3版本**
自己使用了1.5.0的版本或者往上的版本会报错: `Error:Cannot get property 'taskDependencies' on null object`

2. 在app的build.gradle最上面添加:

```
apply plugin: "cn.jiajixin.nuwa"
```
然后再添加依赖

```
dependencies {
    compile fileTree(dir: 'libs', include: ['*.jar'])
    testCompile 'junit:junit:4.12'
    compile 'com.android.support:appcompat-v7:23.0.1'
    compile 'com.android.support:design:23.0.1'
    compile 'cn.jiajixin.nuwa:nuwa:1.0.0'
}
```

##使用
1. 自定义Application类,并在`attachBaseContext()`中添加

```java
public class BaseApplication extends Application {
    @Override
    protected void attachBaseContext(Context base) {
        super.attachBaseContext(base);
        Nuwa.init(this);
        Nuwa.loadPatch(this, "/sdcard/patch.jar");
    }
}
```

2. 运行并安装apk，会在`app/build/outputs/`目录下自动生成一个叫`nuwa`的目录：

![](/media/14518197949458.jpg)

将其拷贝到其他目录下,比如`/Users/***/Desktop/nuwa`

3. 然后假设修改一下代码, 改一个bug, 重新部署一下
4. 部署完成后, 在项目根目录下执行

```
./gradlew clean nuwaDebugPatch -P NuwaDir=/Users/***/Desktop/nuwa
```
这个时候就会在`app/build/outputs/nuwa/debug/`目录下会自动生成`patch.jar`文件
![](/media/14518200581827.jpg)


5. 这个patch.jar就是需要发布的补丁包, 我们先把他放到sdcard中

```
adb push app/build/outputs/nuwa/debug/patch.jar /sdcard/
```

这个时候重启app, 就会显示修复完成的样子

#代码混淆
在proguard-rules.pro中添加：

-keep class cn.jiajixin.nuwa.* { ; }



#参考
[Nuwa github地址](https://github.com/jasonross/Nuwa)
[Nuwa gradle github地址](https://github.com/jasonross/NuwaGradle)
[基于Nuwa实现Android自动化HotFix](http://www.jianshu.com/p/72c17fb76f21)


